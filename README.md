# 日報・月報作成システム

## 概要
Excelファイル（◆2024年度確認表◆.xlsx）をドラッグ&ドロップして、日報・月報を自動生成するWebアプリケーションです。
クライアントサイド（ブラウザ）で完結する処理のため、データの外部送信やサーバー保存は一切行いません。

## 主要機能

### 1. データ処理・集計
- Excelファイルのドラッグ&ドロップ対応
- 日報・月報の自動生成
- 担当者別ランキング集計
- 公休日・禁止日施工件数の集計
- 以下の項目の自動集計：
  - 受注件数（条件に基づく判定）
  - 時間外対応件数（18:30以降）
  - 地区別受注件数（九州・中四国・関西・関東）
  - 年齢別集計（70歳以上・69歳以下）
  - 過量販売件数・単独契約件数
  - 公休日施工・禁止日施工件数

### 2. 担当者別ランキング（月報のみ）
- ①契約者70歳以上の受注件数トップ10ランキング
- ②単独契約を持っている担当者一覧
- ③過量契約を持っている担当者一覧
- ④69歳以下契約件数の担当別件数
- 各ランキングの表示/非表示切り替え機能

### 3. 出力機能
- PDF出力（日報・月報、ランキング①②③）
- CSV出力（日報・月報は横形式、ランキング①②③④は個別ファイル）
- データ確認（全件表示・フィルタリング機能）

### 4. カレンダー機能
- 公休日・禁止日の設定（カレンダーUI）
- 設定データのローカル保存

## 技術仕様
- **フロントエンド**: HTML5, CSS3, TypeScript
- **UIフレームワーク**: Bootstrap 5
- **Excel処理**: SheetJS (xlsx)
- **PDF出力**: jsPDF
- **CSV出力**: FileSaver.js
- **データ保存**: ローカルストレージ

## セットアップ

### 1. 依存関係のインストール
```bash
npm install
```

### 2. TypeScriptのコンパイル
```bash
# グローバルにTypeScriptをインストール
npm install -g typescript

# プロジェクトのコンパイル
tsc src/*.ts --outDir dist --target ES2020 --module ES2020 --moduleResolution node --strict --esModuleInterop --skipLibCheck --forceConsistentCasingInFileNames --declaration --sourceMap
```

### 3. ブラウザでアクセス
```
# 直接HTMLファイルを開く（file://）
index.html

# または、ローカルサーバーを使用
# Python 3の場合
python -m http.server 8000

# Node.jsの場合
npx http-server -p 8000
```

### 4. テスト
```
test.html で基本的な動作確認ができます
```

## 使用方法

### 1. 初期設定
1. **公休日・禁止日の設定**
   - 「公休日・禁止日設定」ボタンをクリック
   - カレンダーUIで公休日・禁止日を選択
   - 「設定を保存」で保存（ローカルストレージに保存）

### 2. データのアップロード
1. **ファイルの準備**
   - 対象のExcelファイル（◆2024年度確認表◆.xlsx）を準備
2. **アップロード**
   - 左サイドバーのドロップゾーンにファイルをドラッグ&ドロップ
   - または「ファイル選択」ボタンでファイルを選択
   - 読み込み開始・完了メッセージが表示される

### 3. 日報の生成
1. **日付選択**
   - 「日付選択」で対象日を選択
2. **日報生成**
   - 「日報生成」ボタンをクリック
   - 「日報」タブに結果が表示される
3. **出力**
   - PDF出力：「PDF出力」ボタンをクリック
   - CSV出力：「CSV出力」ボタンをクリック

### 4. 月報の生成
1. **月選択**
   - 「月報作成月」で対象月を選択（例：2025-08）
2. **月報生成**
   - 「月報生成」ボタンをクリック
   - 「月報」タブに結果が表示される
3. **ランキング表示**
   - 各ランキングの「表示/非表示」ボタンで切り替え
   - デフォルトは非表示
4. **出力**
   - PDF出力：ランキング①②③が含まれる
   - CSV出力：ランキング①②③④が個別ファイルで出力

### 5. データ確認・担当別データ
1. **データ確認タブ**
   - 全件データの確認
   - 担当者名・地区№・所属№でフィルタリング可能
2. **担当別データタブ**
   - 担当者別の集計結果を表示
   - 受注件数・年齢別・単独・過量・時間外の詳細

## データ仕様

### 入力ファイル形式
- Excelファイル（.xlsx, .xls）
- 以下の列構成が必要：
  - A列：日付
  - B列：時間
  - C列：地区№
  - F列：契約者
  - G列：年齢
  - K列：確認者日時（過量・単独の判定に使用）

### 地区分類
- 511：九州地区
- 521+531：中四国地区（合算）
- 541：関西地区
- 561：関東地区

### 判定ロジック
- **高齢者**: 70歳以上
- **過量販売**: K列に「過量」文言が含まれる
- **単独契約**: K列に「単独」文言が含まれる
- **時間外対応**: A列+B列またはC列が18:30以降

## ファイル構成
```
日報月報システム/
├── src/
│   ├── app.ts              # メインアプリケーション
│   ├── excel-processor.ts  # Excelファイル処理
│   ├── report-generator.ts # レポート生成
│   ├── data-manager.ts     # データ管理
│   └── types.ts            # 型定義
├── dist/                   # コンパイル後のファイル
├── index.html              # メインHTML
├── styles.css              # スタイルシート
├── package.json            # 依存関係
├── tsconfig.json           # TypeScript設定
└── README.md               # このファイル
```

## セキュリティ・安全性

### データ保護
- **サーバー送信なし**: アップロードされたExcelファイルはサーバーに送信されません
- **メモリ処理のみ**: ファイルはブラウザのメモリ内でのみ処理されます
- **一時保存なし**: ファイルデータは一切保存されません（公休日設定除く）
- **クライアントサイド完結**: すべての処理がブラウザ内で完結します

### GitHub Pagesでのデプロイ安全性
- **静的ファイルのみ**: HTML/CSS/JSファイルのみが公開されます
- **データベース不要**: サーバーサイドの処理やデータベースは使用しません
- **機密データ非保存**: 機密性の高いExcelデータは保存・送信されません
- **認証制御**: プライベートリポジトリで組織内アクセス制限が可能

### 推奨デプロイメント方法
1. **GitHub Pages（推奨）**
   - プライベートリポジトリでの運用
   - 組織アカウントでのアクセス制御
   - HTTPS通信による暗号化
   - URL: `https://yourusername.github.io/sx-kpi/`

2. **社内サーバー**
   - 社内ネットワーク内での運用
   - VPN経由でのアクセス制限

## システム要件・注意事項
- **ブラウザ**: モダンブラウザ（Chrome, Firefox, Edge等）が必要
- **ファイルサイズ**: 大きなExcelファイル（10MB以上）は処理に時間がかかる場合があります
- **ローカルストレージ**: 公休日・禁止日設定のみローカルストレージに保存されます
- **ネットワーク**: インターネット接続不要（CDNライブラリを除く）

## トラブルシューティング

### Excelファイルが読み込めない
- ファイル形式が.xlsxまたは.xlsであることを確認
- ファイルが破損していないか確認
- ブラウザのコンソールでエラーメッセージを確認

### 集計結果が正しくない
- Excelファイルの列構成が仕様通りか確認
- 日付形式が正しいか確認
- データの9行目以降に実際のデータがあるか確認

### PDF・CSVが出力できない
- ブラウザのポップアップブロッカーを無効化
- ファイルのダウンロード権限を確認

## ライセンス
MIT License

## サポート
問題が発生した場合は、ブラウザのコンソールに表示されるエラーメッセージを確認してください。